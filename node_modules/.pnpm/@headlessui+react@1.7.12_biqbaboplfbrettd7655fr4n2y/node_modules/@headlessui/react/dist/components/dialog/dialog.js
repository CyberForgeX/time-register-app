import T,{createContext as ge,createRef as Te,useCallback as K,useContext as V,useEffect as I,useMemo as R,useReducer as ce,useRef as w,useState as De}from"react";import{match as B}from'../../utils/match.js';import{forwardRefWithAs as v,render as O,Features as q}from'../../utils/render.js';import{useSyncRefs as b}from'../../hooks/use-sync-refs.js';import{Keys as me}from'../keyboard.js';import{isDisabledReactIssue7711 as Pe}from'../../utils/bugs.js';import{useId as h}from'../../hooks/use-id.js';import{FocusTrap as S}from'../../components/focus-trap/focus-trap.js';import{Portal as G}from'../../components/portal/portal.js';import{ForcePortalRoot as U}from'../../internal/portal-force-root.js';import{Description as ye,useDescriptions as Ee}from'../description/description.js';import{useOpenClosed as Ae,State as _}from'../../internal/open-closed.js';import{useServerHandoffComplete as Re}from'../../hooks/use-server-handoff-complete.js';import{StackProvider as Ce,StackMessage as z}from'../../internal/stack-context.js';import{useOutsideClick as ve}from'../../hooks/use-outside-click.js';import{useOwnerDocument as Oe}from'../../hooks/use-owner.js';import{useEventListener as be}from'../../hooks/use-event-listener.js';import{Hidden as he,Features as Se}from'../../internal/hidden.js';import{useEvent as C}from'../../hooks/use-event.js';import{useDocumentOverflowLockedEffect as Le}from'../../hooks/document-overflow/use-document-overflow.js';import{useInert as Q}from'../../hooks/use-inert.js';var Fe=(o=>(o[o.Open=0]="Open",o[o.Closed=1]="Closed",o))(Fe||{}),ke=(e=>(e[e.SetTitleId=0]="SetTitleId",e))(ke||{});let xe={[0](t,e){return t.titleId===e.id?t:{...t,titleId:e.id}}},M=ge(null);M.displayName="DialogContext";function L(t){let e=V(M);if(e===null){let o=new Error(`<${t} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(o,L),o}return e}function _e(t,e,o=()=>[document.body]){Le(t,e,p=>{var n;return{containers:[...(n=p.containers)!=null?n:[],o]}})}function Me(t,e){return B(e.type,xe,t,e)}let He="div",Ie=q.RenderStrategy|q.Static;function we(t,e){let o=h(),{id:p=`headlessui-dialog-${o}`,open:n,onClose:l,initialFocus:u,__demoMode:c=!1,...D}=t,[P,F]=De(0),a=Ae();n===void 0&&a!==null&&(n=(a&_.Open)===_.Open);let H=w(new Set),m=w(null),Z=b(m,e),y=w(null),d=Oe(m),N=t.hasOwnProperty("open")||a!==null,Y=t.hasOwnProperty("onClose");if(!N&&!Y)throw new Error("You have to provide an `open` and an `onClose` prop to the `Dialog` component.");if(!N)throw new Error("You provided an `onClose` prop to the `Dialog`, but forgot an `open` prop.");if(!Y)throw new Error("You provided an `open` prop to the `Dialog`, but forgot an `onClose` prop.");if(typeof n!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${n}`);if(typeof l!="function")throw new Error(`You provided an \`onClose\` prop to the \`Dialog\`, but the value is not a function. Received: ${l}`);let f=n?0:1,[E,ee]=ce(Me,{titleId:null,descriptionId:null,panelRef:Te()}),A=C(()=>l(!1)),$=C(r=>ee({type:0,id:r})),k=Re()?c?!1:f===0:!1,x=P>1,W=V(M)!==null,te=x?"parent":"leaf",j=a!==null?(a&_.Closing)===_.Closing:!1,oe=(()=>W||j?!1:k)(),re=K(()=>{var r,g;return(g=Array.from((r=d==null?void 0:d.querySelectorAll("body > *"))!=null?r:[]).find(i=>i.id==="headlessui-portal-root"?!1:i.contains(y.current)&&i instanceof HTMLElement))!=null?g:null},[y]);Q(re,oe);let ne=(()=>x?!0:k)(),le=K(()=>{var r,g;return(g=Array.from((r=d==null?void 0:d.querySelectorAll("[data-headlessui-portal]"))!=null?r:[]).find(i=>i.contains(y.current)&&i instanceof HTMLElement))!=null?g:null},[y]);Q(le,ne);let J=C(()=>{var g,i;return[...Array.from((g=d==null?void 0:d.querySelectorAll("html > *, body > *, [data-headlessui-portal]"))!=null?g:[]).filter(s=>!(s===document.body||s===document.head||!(s instanceof HTMLElement)||s.contains(y.current)||E.panelRef.current&&s.contains(E.panelRef.current))),(i=E.panelRef.current)!=null?i:m.current]}),ae=(()=>!(!k||x))();ve(()=>J(),A,ae);let ie=(()=>!(x||f!==0))();be(d==null?void 0:d.defaultView,"keydown",r=>{ie&&(r.defaultPrevented||r.key===me.Escape&&(r.preventDefault(),r.stopPropagation(),A()))});let se=(()=>!(j||f!==0||W))();_e(d,se,J),I(()=>{if(f!==0||!m.current)return;let r=new ResizeObserver(g=>{for(let i of g){let s=i.target.getBoundingClientRect();s.x===0&&s.y===0&&s.width===0&&s.height===0&&A()}});return r.observe(m.current),()=>r.disconnect()},[f,m,A]);let[pe,de]=Ee(),ue=R(()=>[{dialogState:f,close:A,setTitleId:$},E],[f,E,A,$]),X=R(()=>({open:f===0}),[f]),fe={ref:Z,id:p,role:"dialog","aria-modal":f===0?!0:void 0,"aria-labelledby":E.titleId,"aria-describedby":pe};return T.createElement(Ce,{type:"Dialog",enabled:f===0,element:m,onUpdate:C((r,g,i)=>{g==="Dialog"&&B(r,{[z.Add](){H.current.add(i),F(s=>s+1)},[z.Remove](){H.current.add(i),F(s=>s-1)}})})},T.createElement(U,{force:!0},T.createElement(G,null,T.createElement(M.Provider,{value:ue},T.createElement(G.Group,{target:m},T.createElement(U,{force:!1},T.createElement(de,{slot:X,name:"Dialog.Description"},T.createElement(S,{initialFocus:u,containers:H,features:k?B(te,{parent:S.features.RestoreFocus,leaf:S.features.All&~S.features.FocusLock}):S.features.None},O({ourProps:fe,theirProps:D,slot:X,defaultTag:He,features:Ie,visible:f===0,name:"Dialog"})))))))),T.createElement(he,{features:Se.Hidden,ref:y}))}let Be="div";function Ge(t,e){let o=h(),{id:p=`headlessui-dialog-overlay-${o}`,...n}=t,[{dialogState:l,close:u}]=L("Dialog.Overlay"),c=b(e),D=C(a=>{if(a.target===a.currentTarget){if(Pe(a.currentTarget))return a.preventDefault();a.preventDefault(),a.stopPropagation(),u()}}),P=R(()=>({open:l===0}),[l]);return O({ourProps:{ref:c,id:p,"aria-hidden":!0,onClick:D},theirProps:n,slot:P,defaultTag:Be,name:"Dialog.Overlay"})}let Ue="div";function Ne(t,e){let o=h(),{id:p=`headlessui-dialog-backdrop-${o}`,...n}=t,[{dialogState:l},u]=L("Dialog.Backdrop"),c=b(e);I(()=>{if(u.panelRef.current===null)throw new Error("A <Dialog.Backdrop /> component is being used, but a <Dialog.Panel /> component is missing.")},[u.panelRef]);let D=R(()=>({open:l===0}),[l]);return T.createElement(U,{force:!0},T.createElement(G,null,O({ourProps:{ref:c,id:p,"aria-hidden":!0},theirProps:n,slot:D,defaultTag:Ue,name:"Dialog.Backdrop"})))}let Ye="div";function $e(t,e){let o=h(),{id:p=`headlessui-dialog-panel-${o}`,...n}=t,[{dialogState:l},u]=L("Dialog.Panel"),c=b(e,u.panelRef),D=R(()=>({open:l===0}),[l]),P=C(a=>{a.stopPropagation()});return O({ourProps:{ref:c,id:p,onClick:P},theirProps:n,slot:D,defaultTag:Ye,name:"Dialog.Panel"})}let We="h2";function je(t,e){let o=h(),{id:p=`headlessui-dialog-title-${o}`,...n}=t,[{dialogState:l,setTitleId:u}]=L("Dialog.Title"),c=b(e);I(()=>(u(p),()=>u(null)),[p,u]);let D=R(()=>({open:l===0}),[l]);return O({ourProps:{ref:c,id:p},theirProps:n,slot:D,defaultTag:We,name:"Dialog.Title"})}let Je=v(we),Xe=v(Ne),Ke=v($e),Ve=v(Ge),qe=v(je),Ft=Object.assign(Je,{Backdrop:Xe,Panel:Ke,Overlay:Ve,Title:qe,Description:ye});export{Ft as Dialog};
